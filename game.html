<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–¢–∏—Ä ‚Äî –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∏–≥—Ä–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</title>
  <style>
    body {
      font-family: monospace;
      background: #111;
      color: #0f0;
      padding: 20px;
    }
    #console {
      background: #000;
      padding: 20px;
      border: 2px solid #0f0;
      height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      display: none;
    }
    #input {
      width: 100%;
      font-family: monospace;
      font-size: 16px;
      padding: 10px;
      background: #222;
      color: #0f0;
      border: 2px solid #0f0;
      margin-top: 10px;
      display: none;
    }
    #menu {
      text-align: center;
      margin-top: 50px;
    }
    #menu button, #menu select {
      background: #000;
      color: #0f0;
      font-family: monospace;
      font-size: 18px;
      padding: 10px 20px;
      margin: 10px;
      border: 2px solid #0f0;
      cursor: pointer;
    }
    #menu button:hover, #menu select:hover {
      background: #0f0;
      color: #000;
    }
    #statsDisplay {
      margin-top: 20px;
      color: #0f0;
      font-size: 16px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>–ò–≥—Ä–∞ "–¢–∏—Ä" –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</h1>

  <div id="menu">
    <label for="difficulty">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
    <select id="difficulty">
      <option value="9">–õ–µ–≥–∫–æ</option>
      <option value="6">–°—Ä–µ–¥–Ω–µ</option>
      <option value="3">–¢—è–∂–µ–ª–æ</option>
    </select>
    <br>
    <button onclick="openGame()">–ò–≥—Ä–∞—Ç—å</button>
    <button onclick="rules()">–ü—Ä–∞–≤–∏–ª–∞</button>
    <button class="btn" onclick="location.href='index.html'">–í—ã—Ö–æ–¥</button>
    <div id="statsDisplay"></div>
  </div>

  <div id="console"></div>
  <input id="input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏ –Ω–∞–∂–º–∏—Ç–µ Enter...">

  <script>
    const term = document.getElementById('console');
    const input = document.getElementById('input');
    const menu = document.getElementById('menu');
    const statsDisplay = document.getElementById('statsDisplay');
    const difficultySelect = document.getElementById('difficulty');

    const WINNING_SCORE = 3;
    const MAX_CELLS = 9;

    let gameState = 'menu';
    let board = [];
    let targets = [];
    let totalShots = 0;
    let goodShots = 0;

    let playerWins = parseInt(localStorage.getItem('wins')) || 0;
    let botWins = parseInt(localStorage.getItem('losses')) || 0;
    let record = parseInt(localStorage.getItem('record')) || 0;
    let gamesPlayed = playerWins + botWins;

    function saveStats() {
      localStorage.setItem('wins', playerWins);
      localStorage.setItem('losses', botWins);
      localStorage.setItem('record', record);
    }

    function updateStatsDisplay() {
      statsDisplay.innerText = `–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ: ${gamesPlayed} | –ü–æ–±–µ–¥: ${playerWins} | –ü–æ—Ä–∞–∂–µ–Ω–∏–π: ${botWins} | –†–µ–∫–æ—Ä–¥: ${record}`;
    }

    function log(text = '') {
      term.textContent += text + '\n';
      term.scrollTop = term.scrollHeight;
    }

    function printBoard() {
      let str = '\n';
      for (let i = 0; i < 3; i++) {
        str += board.slice(i * 3, (i + 1) * 3).map(cell => cell || ' ').join(' | ') + '\n';
        if (i < 2) str += '---------\n';
      }
      str += `\n–û—Å—Ç–∞–ª–æ—Å—å –≤—ã—Å—Ç—Ä–µ–ª–æ–≤: ${totalShots}\n`;
      log(str);
    }

    function openGame() {
      menu.style.display = 'none';
      term.style.display = 'block';
      input.style.display = 'block';
      term.textContent = '';
      const selectedDifficulty = parseInt(difficultySelect.value);
      startGame(selectedDifficulty);
    }

    function showMenu() {
      gameState = 'menu';
      menu.style.display = 'block';
      term.style.display = 'none';
      input.style.display = 'none';
      updateStatsDisplay();
    }

    function startGame(level) {
      board = Array(9).fill('');
      goodShots = 0;
      targets = [];
      totalShots = level;
      gameState = 'game';
      while (targets.length < 3) {
        let r = Math.floor(Math.random() * 9);
        if (!targets.includes(r)) targets.push(r);
      }
      log("\n–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!");
      printBoard();
      log("–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 9 (0 –¥–ª—è –≤—ã—Ö–æ–¥–∞ –≤ –º–µ–Ω—é):");
    }

    function rules() {
      menu.style.display = 'none';
      term.style.display = 'block';
      input.style.display = 'block';
      gameState = 'rules';
      term.textContent = '';
      log(`\n–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã "–¢–∏—Ä":
1. –ü–æ–ª–µ 3x3, —è—á–µ–π–∫–∏ –æ—Ç 1 –¥–æ 9.
2. –£ –≤–∞—Å –µ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ –≤—ã—Å—Ç—Ä–µ–ª–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
3. –ë–æ—Ç –≤—ã–±–∏—Ä–∞–µ—Ç 3 –º–∏—à–µ–Ω–∏.
4. –í—ã –≤–≤–æ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —è—á–µ–π–∫–∏.
5. –ü–æ–ø–∞–¥–∞–Ω–∏–µ ‚Äî "O", –ø—Ä–æ–º–∞—Ö ‚Äî "X".
6. –ü–æ–±–µ–¥–∞ ‚Äî 3 –ø–æ–ø–∞–¥–∞–Ω–∏—è. –ü–æ—Ä–∞–∂–µ–Ω–∏–µ ‚Äî –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –≤—ã—Å—Ç—Ä–µ–ª—ã.
\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –º–µ–Ω—é.`);
    }

    function gameInput(val) {
      const num = parseInt(val);
      if (num === 0) {
        log("–í—ã—Ö–æ–¥ –≤ –º–µ–Ω—é...");
        showMenu();
        return;
      }
      const idx = num - 1;
      if (idx < 0 || idx >= 9 || board[idx]) {
        log("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ö–æ–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
        return;
      }
      if (targets.includes(idx)) {
        board[idx] = 'O';
        goodShots++;
      } else {
        board[idx] = 'X';
      }
      totalShots--;
      printBoard();

      if (goodShots >= WINNING_SCORE) {
        log("\n–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!");
        playerWins++;
        if (playerWins > record) {
          record = playerWins;
          log("üéâ –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥! üéâ");
        }
        gameState = 'post';
        saveStats();
        gamesPlayed = playerWins + botWins;
        log("–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –º–µ–Ω—é.");
      } else if (totalShots <= 0) {
        log("\n–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! –ú–∏—à–µ–Ω–∏ –±—ã–ª–∏: " + targets.map(i => i + 1).join(", "));
        botWins++;
        gameState = 'post';
        saveStats();
        gamesPlayed = playerWins + botWins;
        log("–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –º–µ–Ω—é.");
      } else {
        log("–í–≤–µ–¥–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥:");
      }
    }

    function exitGame() {
      menu.innerHTML = '<h2>–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!</h2>';
    }

    input.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
        const val = input.value.trim();
        input.value = '';
        if (!val && (gameState === 'rules' || gameState === 'post')) {
          showMenu();
          return;
        }
        if (gameState === 'game') {
          gameInput(val);
        }
      }
    });

    updateStatsDisplay();
  </script>
</body>
</html>